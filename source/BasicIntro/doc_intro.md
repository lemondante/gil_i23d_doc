# 文档简介

## 前人栽树，后人乘凉

本文档是i23d分布式三维重建系统的操作文档与代码说明，主要记载配置i23d时的各种坑，并分析i23d系统代码。
也欢迎大家一起贡献文档。

## 本文档阅读所需的前置知识

本文档阅读者需要了解基于多视图几何三维重建的相关概念，计算机网络相关知识，以及基础的C++、Python、docker知识。

基于多视图几何的三维重建，本质即通过对某位置的多视角图片反求该处深度的算法流程。其首先需要获得图片的相机坐标（称为外参）与镜头参数（称为内参），用于定义场景信息。随后根据某处在多张图片中出现的位置的不同，推断出该处在三维空间中应该处于什么位置。通常以像素为单位进行深度推算，最终得到场景的三维点云，每个点为每张图像中对应的一个像素。若有需要，可进行网格生成、简化与纹理映射，转化为最终需要的网格模型。

通常其包括如下基本模块：

+ 特征提取
+ 特征匹配
+ 运动恢复结构（Structure from Motion, SfM）
+ 稠密点云重建（Multi View stereo, MVS）
+ 网格生成与简化
+ 纹理映射

其中，特征提取与匹配的目的是获取场景中不变的特征信息，利用运动恢复结构算法获得初步的场景表示与相机内外参，在*ContextCapture*中被称为*空中三角测量*，在*PhotoScan*中被称为*Align photos*。后三步则为具体的三维重建任务。i23d系统在此基础上增加了分布式任务分发与回收、全景图拼接、语义分割等功能。

i23d的分布式架构本质是Master-Worker架构，由一台master服务器与多台worker服务器构成。其借助rpc框架进行远程函数调用，可简单看作master发布任务，worker接收并完成任务，master回收结果的步骤。系统的理论并行效率提升倍数约等于worker服务器的数量（通常不高过这个值）。

i23d系统运行与Linux系统之上。脱胎于开源软件colmap，其主要基于C++语言进行构建。鉴于colmap优秀的代码模块化设计，本系统仍保留了colmap的大致框架，并在其中进行了具体算法模块替换，以获得更优异的性能。其中MVS模块与全景图拼接模块主要基于Python代码，多模块之间采用shell脚本串联。为了方便迁移，系统运行在docker上，可直接在不同物理机上加载镜像，快速部署。